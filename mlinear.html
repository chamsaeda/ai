<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‹¤ì¤‘ì„ í˜•íšŒê·€ë€ ë¬´ì—‡ì¼ê¹Œ?</title>
    <style>
         /* ìƒˆë¡œ ì¶”ê°€í•œ ğŸ¯ ì•„ì´ì½˜ì— ëŒ€í•œ ìŠ¤íƒ€ì¼ */
#ridgeIcon {
    margin-right: 5px; /* í…ìŠ¤íŠ¸ì™€ì˜ ê°„ê²© */
    color: #ef4444; /* ë¹¨ê°„ìƒ‰ ê³„ì—´ë¡œ ëª©í‘œ(ğŸ¯) ê°•ì¡° */
    cursor: pointer; /* ë§ˆìš°ìŠ¤ ì»¤ì„œë¥¼ ì†ê°€ë½ ëª¨ì–‘ìœ¼ë¡œ ë°”ê¿”ì„œ í´ë¦­ ê°€ëŠ¥í•¨ì„ í‘œì‹œ */
    font-size: 1.2em; /* í¬ê¸° ì•½ê°„ í‚¤ìš°ê¸° */
    font-weight: bold;
}
/* [ìˆ˜ì •] íŒì—… ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ - íˆ´íŒì²˜ëŸ¼ ë³´ì´ë„ë¡ ìˆ˜ì • */
#sparrowPopup {
    position: absolute; /* í•µì‹¬: ì ˆëŒ€ ìœ„ì¹˜ë¡œ ì„¤ì • (í´ë¦­ ìœ„ì¹˜ ê¸°ì¤€ìœ¼ë¡œ í‘œì‹œ) */
    background-color: #374151; /* ì–´ë‘ìš´ ë°°ê²½ */
    color: white; /* í°ìƒ‰ ê¸€ì */
    padding: 6px 10px; /* ì‘ì€ í¬ê¸° */
    border-radius: 4px;
    font-size: 0.85em; /* ì‘ì€ ê¸€ì”¨ */
    font-weight: normal;
    white-space: nowrap; /* ë‚´ìš©ì´ í•œ ì¤„ë¡œ ë‚˜ì˜¤ë„ë¡ */
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    z-index: 1000;
    opacity: 0; 
    pointer-events: none; 
    transition: opacity 0.2s ease-in-out; 
}

#sparrowPopup.show {
    opacity: 1;
}

/* íˆ´íŒ ê¼¬ë¦¬(ì„ íƒ ì‚¬í•­: ë” íˆ´íŒì²˜ëŸ¼ ë³´ì´ê²Œ ì¶”ê°€) */
#sparrowPopup::after {
    content: "";
    position: absolute;
    top: -5px; /* íˆ´íŒ ìœ„ìª½ì— ê¼¬ë¦¬ê°€ ë‚˜ì˜¤ë„ë¡ ìœ„ì¹˜ ì¡°ì • */
    left: 10px;
    border-width: 5px;
    border-style: solid;
    border-color: transparent transparent #374151 transparent; /* ê¼¬ë¦¬ ìƒ‰ìƒ */
}
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #e0e7ff 0%, #f3e8ff 100%);
            padding: 20px; min-height: 100vh;
        }
.data-table-container {
    max-height: 180px;           /* 5ì¤„ë§Œ ë³´ì´ê²Œ! */
    overflow-y: auto;            /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ */
    border-radius: 6px;
    border: 1px solid #e5e7eb;
    background: white;
}

.data-table-container table {
    width: 100%;
    border-collapse: collapse;
    font-size: .875rem;
}

.data-table-container table tr {
    height: 36px;                 /* í•œ ì¤„ë‹¹ ë†’ì´ ê³ ì • */
}

.data-table-container th {
    background: #ddd6fe;
    border: 1px solid #c084fc;
    padding: 8px;
    text-align: center;
    position: sticky;
    top: 0;
    z-index: 1;
}

.data-table-container td {
    border: 1px solid #d1d5db;
    padding: 8px;
    text-align: center;
    background: white;
}

.data-table-container tr:hover td {
    background: #faf5ff;
}
.coef-table {
    background: white;
    border-radius: 6px;
    padding: 12px;
    width: 300px;           /* ì—¬ê¸°ì„œ ë„ˆë¹„ ê³ ì •! */
    overflow-x: auto;       /* ë„˜ì¹˜ë©´ ê°€ë¡œ ìŠ¤í¬ë¡¤ */
    margin: 0 auto;         /* ê°€ìš´ë° ì •ë ¬ (ì„ íƒ) */
}

.coef-table table {
    width: 100%;
    /* table-layout: fixed;    /* í•µì‹¬: ì…€ ë„ˆë¹„ ê· ë“± ë°°ë¶„ */
    font-size: .9rem;
}

.coef-table th, .coef-table td {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    text-align: center;
}

.coef-table th {
    background: #dbeafe;
    border: 1px solid #93c5fd;
}
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 16px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #7c3aed; margin-bottom: 10px; font-size: 2em; }
        .subtitle { text-align: center; color: #6b7280; margin-bottom: 30px; line-height: 1.6; }

        .main-grid { display: grid; grid-template-columns: 1fr 1.5fr; gap: 30px; margin-bottom: 30px; }
        .panel { background: white; border-radius: 12px; padding: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .panel h2 { color: #7c3aed; margin-bottom: 20px; font-size: 1.3em; }

        .setting-group { margin-bottom: 24px; padding: 16px; border-radius: 8px; }
        .setting-group.purple { background: #faf5ff; }
        .setting-group.yellow { background: #fefce8; }
        .setting-group.green { background: #f0fdf4; }

        label { display: block; font-weight: 600; margin-bottom: 8px; color: #374151; }
        select, input[type="range"] { width: 100%; padding: 8px; border: 2px solid #d1d5db; border-radius: 6px; font-size: 14px; }
        input[type="range"] { padding: 0; }
        .radio-group { display: flex; flex-direction: column; gap: 8px; }
        .radio-option { display: flex; align-items: center; padding: 12px; background: #f9fafb; border-radius: 6px; cursor: pointer; transition: background .2s; }
        .radio-option:hover { background: #f3e8ff; }
        .radio-option input { margin-right: 10px; }
        .description { font-size: .875rem; color: #6b7280; margin-top: 8px; }

        .info-box { padding: 16px; border-radius: 8px; background: linear-gradient(135deg,#faf5ff 0%,#eff6ff 100%); border: 2px solid #c084fc; margin-top: 24px; }
        .info-box h3 { color: #7c3aed; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }

        .table-wrapper { background: #f9fafb; padding: 16px; border-radius: 8px; margin-bottom: 20px; }
        .table-wrapper h3 { color: #374151; margin-bottom: 12px; }
       
        table { width: 100%; border-collapse: collapse; font-size: .875rem; }
        th { background: #ddd6fe; border: 1px solid #c084fc; padding: 8px; text-align: center; position: sticky; top:0; z-index:1; }
        td { border: 1px solid #d1d5db; padding: 8px; text-align: center; background: white; }
        tr:hover td { background: #faf5ff; }

        .formula-box { background: #eff6ff; padding: 16px; border-radius: 8px; margin-top: 20px; }
        .formula-box h3 { color: #1e40af; margin-bottom: 12px; }
        .formula { font-family: 'Courier New', monospace; font-size: 1.1em; background: white; padding: 16px; border-radius: 6px; border: 2px solid #93c5fd; margin-bottom: 12px; }

        .coef-table { background: white; border-radius: 6px; padding: 12px; }
        .coef-table table { font-size: .9rem; width: 100%; }
        .coef-table th { background: #dbeafe; border: 1px solid #93c5fd; }
        .highlight { background: #fef3c7 !important; font-weight: 600; }

        .scatter-section { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .chart-container { background: #f9fafb; padding: 20px; border-radius: 8px; }
        .chart-container h3 { margin-bottom: 12px; }

        .tips-section { background: #fefce8; padding: 16px; border-radius: 8px; border-left: 4px solid #facc15; margin-top: 20px; }
        .tips-section ul { margin-left: 20px; margin-top: 8px; }
        .tips-section li { margin-bottom: 4px; color: #374151; }

        .bottom-cards { display: grid; grid-template-columns: repeat(3,1fr); gap: 16px; margin-top: 30px; }
        .card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,.08); }
        .card h3 { color: #7c3aed; margin-bottom: 8px; }
        .card p { font-size: .875rem; color: #6b7280; line-height: 1.5; }

        @media (max-width: 1200px) {
            .main-grid, .scatter-section, .bottom-cards { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <font color="blue" size="2">ë¶€ì‚°ì§„ì—¬ììƒì—…ê³ ë“±í•™êµ ì¸ê³µì§€ëŠ¥ê¸°ì´ˆ í•™ìŠµìë£Œ</font>
        <h1>ë‹¤ì¤‘ì„ í˜•íšŒê·€ë€ ë¬´ì—‡ì¼ê¹Œ?</h1>
        <p class="subtitle">
            <font color="blue"><b>ì—¬ëŸ¬ ê°œì˜ ì†ì„±(ë³€ìˆ˜)</b></font>ì„ ì‚¬ìš©í•´ì„œ ì˜ˆì¸¡í•˜ëŠ” ëª¨ë¸ì…ë‹ˆë‹¤.<br>
            ë³€ìˆ˜ê°€ ë§ì„ ë•Œ <b>ê³¼ëŒ€ì í•©(overfitting)</b>ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ <font color="red"><b>L1, L2 ì •ê·œí™”</b></font>ê°€ í•„ìš”í•´ìš”!
        </p>

        <div class="main-grid">
            <div class="panel">
                <h2>âš™ï¸ ì„¤ì •</h2>

                <div class="setting-group purple">
                    <label>ğŸ“Š ë°ì´í„° ì„ íƒ</label>
                    <select id="scenario">
                        <option value="student">í•™ìƒ ì„±ì  ì˜ˆì¸¡ (4ê°œ ë³€ìˆ˜)</option>
                        <option value="house">ì§‘ê°’ ì˜ˆì¸¡ (5ê°œ ë³€ìˆ˜)</option>
                        <option value="health">ê±´ê°• ì ìˆ˜ ì˜ˆì¸¡ (6ê°œ ë³€ìˆ˜)</option>
                    </select>
                    <p class="description" id="scenarioDesc">ì—¬ëŸ¬ ìš”ì¸ìœ¼ë¡œ í•™ìƒì˜ ì„±ì ì„ ì˜ˆì¸¡</p>
                </div>

                <div class="setting-group">
                    <label>ğŸ¯ ì •ê·œí™” ìœ í˜•</label>
                    <div class="radio-group">
                        <label class="radio-option"><input type="radio" name="regType" value="none" checked><span>ì •ê·œí™” ì—†ìŒ</span></label>
                        <label class="radio-option"><input type="radio" name="regType" value="ridge"><span>Ridge (L2) - ëª¨ë“  ì†ì„±(ë³€ìˆ˜) ì¡°ê¸ˆì”© ì‚¬ìš©</span></label>
                        <label class="radio-option"><input type="radio" name="regType" value="lasso"><span>Lasso (L1) - ì¤‘ìš”í•œ ì†ì„±(ë³€ìˆ˜)ë§Œ ì„ íƒ</span></label>
                        <label class="radio-option"><input type="radio" name="regType" value="elastic"><span>Elastic Net - ë‘ ë°©ë²•ì˜ ì¡°í•©</span></label>
                    </div>
                </div>

                <div class="setting-group yellow" id="alphaGroup" style="display:none;">
                    <label>Alpha (ì •ê·œí™” ê°•ë„): <span id="alphaValue">0.10</span></label>
                    <input type="range" id="alpha" min="0" max="1" step="0.01" value="0.1">
                    <p class="description" id="alphaDesc">ì•½í•œ ì •ê·œí™” - ë°ì´í„°ì— ë” ë§ì¶¤</p>
                </div>

                <div class="setting-group green" id="l1RatioGroup" style="display:none;">
                    <label>L1 : L2 ë¹„ìœ¨ = <span id="l1Value">0.50</span> : <span id="l2Value">0.50</span></label>
                    <input type="range" id="l1Ratio" min="0" max="1" step="0.1" value="0.5">
                    <p class="description" id="l1Desc">ê· í˜•ì¡íŒ í˜¼í•©</p>
                </div>

                <div class="info-box" id="regInfo">
                    <h3><span id="regEmoji">ğŸ“</span> <span id="regTitle">ì •ê·œí™” ì—†ìŒ</span></h3>
                    <p id="regDesc">ëª¨ë“  ì†ì„±(ë³€ìˆ˜)ì„ ìµœëŒ€í•œ í™œìš©í•´ìš”. ë³€ìˆ˜ê°€ ë§ìœ¼ë©´ ê³¼ëŒ€ì í•© ìœ„í—˜ì´ ìˆì–´ìš”!</p>
                </div>
            </div>

            <div class="panel">
                <h2>ğŸ“ˆ ê²°ê³¼</h2>

                <div class="table-wrapper">
                    <h3>ğŸ“Š ì‚¬ìš©ëœ ë°ì´í„° (ëª¨ë‘ 10ê°œ)</h3>
                    <div class="data-table-container">
                        <table id="dataTable">
                            <thead><tr id="tableHeader"></tr></thead>
                            <tbody id="dataBody"></tbody>
                        </table>
                    </div>
                    <p class="description" style="margin-top:8px;">ì´ <strong id="dataCount">10</strong>ê°œì˜ ë°ì´í„°ë¡œ í•™ìŠµí–ˆì–´ìš”</p>
                </div>

                <div class="scatter-section">
                    <div class="chart-container">
                        <h3>ğŸ”® ì˜ˆì¸¡ê°’ vs ì‹¤ì œê°’ (ì‚°ì ë„)</h3>
                        <canvas id="scatterChart" style="width:500px; height:400px;"></canvas>
                        <p class="description" style="margin-top:8px;text-align:center;">
                            ğŸ’¡ <strong>ì ë“¤ì´ ì´ˆë¡ì„ ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ì¢‹ì€ ëª¨ë¸!</strong>
                        </p>
                    </div>

                    <div>
                        <div class="formula-box">
                            <h3>ğŸ“ ê³„ìˆ˜(ê°€ì¤‘ì¹˜) í‘œ</h3>
                            <div class="coef-table">
                                <table>
                                    <thead><tr><th>ì†ì„±(ë³€ìˆ˜)</th><th>ê³„ìˆ˜ (ê°€ì¤‘ì¹˜)</th><th>ì¤‘ìš”ë„</th></tr></thead>
                                    <tbody id="coefBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="formula-box">
                    <h3>ğŸ“ ì˜ˆì¸¡ ìˆ˜ì‹</h3>
                    <div class="formula" id="formula">y = 0.00</div>
                </div>

                <div class="tips-section">
                    <p style="font-weight:600;margin-bottom:4px;">ğŸ’¡ ê´€ì°°í•´ë³´ì„¸ìš”!</p>
                    <ul>
                        <li><b>ì •ê·œí™” ì—†ìŒ</b>: ëª¨ë“  ì†ì„±(ë³€ìˆ˜)ì„ í™œìš©í•˜ì§€ë§Œ, ê³¼ëŒ€ì í•© ìœ„í—˜!</li>
                        <li><b>Ridge (L2)</b>: ëª¨ë“  ê³„ìˆ˜ë¥¼ ì¤„ì´ë˜, 0ìœ¼ë¡œ ë§Œë“¤ì§€ëŠ” ì•Šì•„ìš”</li>
                        <li><b>Lasso (L1)</b>: ì¤‘ìš”í•˜ì§€ ì•Šì€ ì†ì„±(ë³€ìˆ˜)ëŠ” 0ìœ¼ë¡œ ë§Œë“¤ì–´ìš”!</li>
                        <li><b>ì‚°ì ë„ì—ì„œ ì ë“¤ì´ ì´ˆë¡ì„ ì— ê°€ê¹Œìš¸ìˆ˜ë¡</b>: ì˜ˆì¸¡ ì •í™•ë„ ë†’ìŒ!</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="bottom-cards">
            <div class="card"><h3><span id="ridgeIcon" class="query-icon">ğŸ¯</span> RidgeëŠ” ì–¸ì œ?</h3><p>ì†ì„±(ë³€ìˆ˜)ì´ ë§ê³  ì„œë¡œ ê´€ë ¨ì´ ìˆì„ ë•Œ! ëª¨ë“  ë³€ìˆ˜ë¥¼ ì¡°ê¸ˆì”© ì‚¬ìš©í•´ìš”.</p></div>
            <div class="card"><h3>ğŸ¯ LassoëŠ” ì–¸ì œ?</h3><p>ì¤‘ìš”í•œ ì†ì„±(ë³€ìˆ˜)ë§Œ ì°¾ê³  ì‹¶ì„ ë•Œ! í•„ìš”ì—†ëŠ” ë³€ìˆ˜ëŠ” ì œê±°í•´ìš”.</p></div>
            <div class="card"><h3>ğŸ¯ ì‚°ì ë„ëŠ” ì–¸ì œ?</h3><p>ëª¨ë¸ì´ ì–¼ë§ˆë‚˜ ì˜ ë§ì·„ëŠ”ì§€ í™•ì¸í•  ë•Œ! y=x ì´ˆë¡ì„ ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ì¢‹ì•„ìš”!</p></div>
        </div>
    </div>
    <div id="sparrowPopup">ì°¸ìƒˆë‹¤!</div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script>
        let currentScenario = 'student', regType = 'none', alpha = 0.1, l1Ratio = 0.5, scatterChart = null;

        const scenarios = {
            student: { name: 'í•™ìƒ ì„±ì  ì˜ˆì¸¡', variables: ['ê³µë¶€ì‹œê°„','ìˆ˜ë©´ì‹œê°„','í•™ì›íšŸìˆ˜','ê²Œì„ì‹œê°„'], target: 'ì„±ì ', data: [], description: 'ì—¬ëŸ¬ ìš”ì¸ìœ¼ë¡œ í•™ìƒì˜ ì„±ì ì„ ì˜ˆì¸¡', min: 30, max: 100 },
            house: { name: 'ì§‘ê°’ ì˜ˆì¸¡', variables: ['í‰ìˆ˜','ë°©ê°œìˆ˜','ì—­ê±°ë¦¬','ì¸µìˆ˜','ê±´ì¶•ë…„ë„'], target: 'ê°€ê²©(ì–µ)', data: [], description: 'ì—¬ëŸ¬ ìš”ì¸ìœ¼ë¡œ ì§‘ê°’ì„ ì˜ˆì¸¡', min: 0, max: 10 },
            health: { name: 'ê±´ê°• ì ìˆ˜', variables: ['ìš´ë™ì‹œê°„','ìˆ˜ë©´ì‹œê°„','ì±„ì†Œì„­ì·¨','ìŠ¤íŠ¸ë ˆìŠ¤','í¡ì—°ì—¬ë¶€','ìŒì£¼íšŸìˆ˜'], target: 'ê±´ê°•ì ìˆ˜', data: [], description: 'ìƒí™œ ìŠµê´€ìœ¼ë¡œ ê±´ê°• ì ìˆ˜ë¥¼ ì˜ˆì¸¡', min: 0, max: 100 }
        };

        function generateStudentData() {
            const data = [];
            for (let i = 0; i < 10; i++) {
                const study = Math.random() * 10;
                const sleep = 5 + Math.random() * 4;
                const academy = Math.floor(Math.random() * 6);
                const game = Math.random() * 5;
                const score = 20 + study * 8 + sleep * 3 + academy * 2 - game * 4 + (Math.random() - 0.5) * 3;
                data.push({ features: [study, sleep, academy, game], target: Math.max(0, Math.min(100, score)) });
            }
            return data;
        }

        function generateHouseData() {
            const data = [];
            for (let i = 0; i < 10; i++) {
                const area = 10 + Math.random() * 40;
                const rooms = 1 + Math.floor(Math.random() * 4);
                const station = Math.random() * 2;
                const floor = Math.floor(Math.random() * 20);
                const age = Math.floor(Math.random() * 30);
                const price = 2 + area * 0.15 + rooms * 0.3 - station * 0.5 + floor * 0.02 - age * 0.05 + (Math.random() - 0.5) * 1;
                data.push({ features: [area, rooms, station, floor, age], target: Math.max(1, price) });
            }
            return data;
        }

        function generateHealthData() {
            const data = [];
            for (let i = 0; i < 10; i++) {
                const exercise = Math.random() * 7;
                const sleep = 5 + Math.random() * 4;
                const vegetables = Math.random() * 5;
                const stress = Math.random() * 10;
                const smoking = Math.random() > 0.7 ? 1 : 0;
                const drinking = Math.floor(Math.random() * 8);
                const health = 50 + exercise * 3 + sleep * 2 + vegetables * 2 - stress * 1.5 - smoking * 15 - drinking * 2 + (Math.random() - 0.5) * 8;
                data.push({ features: [exercise, sleep, vegetables, stress, smoking, drinking], target: Math.max(0, Math.min(100, health)) });
            }
            return data;
        }

        scenarios.student.data = generateStudentData();
        scenarios.house.data = generateHouseData();
        scenarios.health.data = generateHealthData();

        function initScatterChart() {
            const ctx = document.getElementById('scatterChart').getContext('2d');
            scatterChart = new Chart(ctx, {
                type: 'scatter',
                data: { datasets: [
                    { label: 'ì˜ˆì¸¡ vs ì‹¤ì œ', data: [], backgroundColor: 'rgba(139,92,246,0.7)', borderColor: '#7c3aed', borderWidth: 1, pointRadius: 8 },
                    { label: 'ì™„ë²½ ì˜ˆì¸¡ì„  (y=x)', data: [], type: 'line', borderColor: '#10b981', borderWidth: 2, borderDash: [5,5], fill: false, pointRadius: 0 }
                ]},
                options: {
                    responsive: false,
                    scales: {
                        x: { title: { display: true, text: 'ì‹¤ì œê°’' }, min: 0, max: 100 },
                        y: { title: { display: true, text: 'ì˜ˆì¸¡ê°’' }, min: 0, max: 100 }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                beforeLabel: context => context.datasetIndex === 0 ? `ë²ˆí˜¸: ${context.dataIndex + 1}` : '',
                                label: context => context.datasetIndex === 0 ? `ì‹¤ì œ: ${context.parsed.x.toFixed(1)}, ì˜ˆì¸¡: ${context.parsed.y.toFixed(1)}` : context.dataset.label
                            }
                        }
                    }
                }
            });
        }

        function calculateMultipleRegression() {
            const s = scenarios[currentScenario];
            const data = s.data;
            const n = data.length;
            const numFeatures = s.variables.length;
            const XtX = Array(numFeatures).fill(0).map(() => Array(numFeatures).fill(0));
            const Xty = Array(numFeatures).fill(0);

            for (let i = 0; i < n; i++) {
                for (let j = 0; j < numFeatures; j++) {
                    Xty[j] += data[i].features[j] * data[i].target;
                    for (let k = 0; k < numFeatures; k++) {
                        XtX[j][k] += data[i].features[j] * data[i].features[k];
                    }
                }
            }

            let coefficients = solveLinearSystem(XtX, Xty, numFeatures);

            if (regType === 'ridge') {
                for (let i = 0; i < numFeatures; i++) XtX[i][i] += alpha * n;
                coefficients = solveLinearSystem(XtX, Xty, numFeatures);
            } else if (regType === 'lasso') {
                let maxPenalty = 10;
                // ê³„ìˆ˜ í¬ê¸°ì™€ ë¬´ê´€í•˜ê²Œ, Alphaì—ë§Œ ë°˜ì‘í•˜ëŠ” ê³ ì •ëœ ë²Œì¹™!
                // 0 ~ 10 ì‚¬ì´ì—ì„œ ì²œì²œíˆ ì¦ê°€ (10ì´ ìµœëŒ€ ë²Œì¹™)
                if(currentScenario === 'house') {
                    maxPenalty = 0.4;
                }
                const lambda = alpha * maxPenalty;

                for (let i = 0; i < coefficients.length; i++) {
                    const sign = coefficients[i] >= 0 ? 1 : -1;
                    const absCoef = Math.abs(coefficients[i]);
                    coefficients[i] = sign * Math.max(0, absCoef - lambda);
                }
            
    
            } else if (regType === 'elastic') {
                for (let i = 0; i < numFeatures; i++) XtX[i][i] += alpha * (1 - l1Ratio) * n;
                const ridgeCoef = solveLinearSystem(XtX, Xty, numFeatures);
                for (let i = 0; i < coefficients.length; i++) {
                    const sign = ridgeCoef[i] >= 0 ? 1 : -1;
                    coefficients[i] = sign * Math.max(0, Math.abs(ridgeCoef[i]) - alpha * l1Ratio * 5);
                }
            }

            let intercept = 0;
            for (let i = 0; i < n; i++) {
                let pred = 0;
                for (let j = 0; j < numFeatures; j++) pred += coefficients[j] * data[i].features[j];
                intercept += data[i].target - pred;
            }
            intercept /= n;

            return { coefficients, intercept };
        }

        function solveLinearSystem(A, b, n) {
            const x = Array(n).fill(0);
            for (let iter = 0; iter < 200; iter++) {
                for (let i = 0; i < n; i++) {
                    let sum = b[i];
                    for (let j = 0; j < n; j++) if (i !== j) sum -= A[i][j] * x[j];
                    x[i] = sum / (A[i][i] || 1);
                }
            }
            return x;
        }

        function updateTable() {
            const s = scenarios[currentScenario];
            const h = document.getElementById('tableHeader');
            const b = document.getElementById('dataBody');
            h.innerHTML = '<th>ë²ˆí˜¸</th>' + s.variables.map(v => `<th>${v}</th>`).join('') + `<th>${s.target}</th>`;
            b.innerHTML = '';
            s.data.forEach((r,i) => {
                const tr = b.insertRow();
                tr.insertCell(0).textContent = i+1;
                r.features.forEach(v => tr.insertCell(-1).textContent = v.toFixed(1));
                tr.insertCell(-1).textContent = r.target.toFixed(1);
            });
            document.getElementById('dataCount').textContent = s.data.length;
        }

        function updateResults() {
            const s = scenarios[currentScenario];
            const {coefficients, intercept} = calculateMultipleRegression();
            let formula = `${s.target} = ${intercept.toFixed(2)}`;
            s.variables.forEach((v,i) => {
                const sign = coefficients[i] >= 0 ? '+' : '';
                formula += ` ${sign} ${coefficients[i].toFixed(2)} Ã— ${v}`;
            });
            document.getElementById('formula').textContent = formula;

            const cb = document.getElementById('coefBody');
            cb.innerHTML = '';
            const max = Math.max(...coefficients.map(Math.abs)) || 1;
            s.variables.forEach((v,i) => {
                const row = cb.insertRow();
                const zero = Math.abs(coefficients[i]) < 0.01;

                row.insertCell(0).textContent = v;
                row.insertCell(1).textContent = coefficients[i].toFixed(3);

                if (regType === 'none') {
                    row.insertCell(2).textContent = coefficients[i].toFixed(3);
                } else {
                    const imp = Math.abs(coefficients[i]) / max * 100;
                    row.insertCell(2).textContent = zero ? 'ì œê±°ë¨' : `${imp.toFixed(0)}%`;
                }

                if (zero && regType !== 'none') row.className = 'highlight';
            });

            updateScatterChart();
        }

        function updateScatterChart() {
            const s = scenarios[currentScenario];
            const {coefficients, intercept} = calculateMultipleRegression();
            const points = [];
            s.data.forEach((r, index) => {
                let pred = intercept;
                r.features.forEach((v,i) => pred += coefficients[i] * v);

                pred = Math.max(0, Math.min(100, pred));
                points.push({ x: r.target, y: pred });
            });

            const axisMin = s.min;
            const axisMax = s.max;

            if (currentScenario === 'student') {	       
               scatterChart.options.scales.x.max = axisMax + 10;
	       scatterChart.options.scales.y.max = axisMax + 10;
            } else {
               scatterChart.options.scales.x.max = axisMax;
               scatterChart.options.scales.y.max = axisMax;
            }
            scatterChart.options.scales.x.min = axisMin;
            scatterChart.options.scales.y.min = axisMin;
         

            scatterChart.data.datasets[0].data = points;
            scatterChart.data.datasets[1].data = [{x: axisMin, y: axisMin}, {x: axisMax, y: axisMax}];
            scatterChart.update();
        }

        function updateRegInfo() {
            const infos = {
                none: {emoji:'ğŸ“',title:'ì •ê·œí™” ì—†ìŒ',desc:'ëª¨ë“  ì†ì„±(ë³€ìˆ˜)ì„ ìµœëŒ€í•œ í™œìš©í•´ìš”. ë³€ìˆ˜ê°€ ë§ìœ¼ë©´ ê³¼ëŒ€ì í•© ìœ„í—˜ì´ ìˆì–´ìš”!'},
                ridge: {emoji:'ğŸ”ï¸',title:'Ridge (L2)',desc:'ëª¨ë“  ê³„ìˆ˜ë¥¼ ì¤„ì´ë˜, 0ìœ¼ë¡œ ë§Œë“¤ì§€ëŠ” ì•Šì•„ìš”.'},
                lasso: {emoji:'ğŸ¯',title:'Lasso (L1)',desc:'ì¤‘ìš”í•˜ì§€ ì•Šì€ ì†ì„±(ë³€ìˆ˜)ì€ 0ìœ¼ë¡œ ë§Œë“¤ì–´ìš”!'},
                elastic: {emoji:'ğŸ¨',title:'Elastic Net',desc:'Ridgeì™€ Lassoì˜ ì¥ì ì„ ì„ì—ˆì–´ìš”.'}
            };
            const i = infos[regType];
            document.getElementById('regEmoji').textContent = i.emoji;
            document.getElementById('regTitle').textContent = i.title;
            document.getElementById('regDesc').textContent = i.desc;
        }

        document.getElementById('scenario').addEventListener('change', e => {
            currentScenario = e.target.value;
            document.getElementById('scenarioDesc').textContent = scenarios[currentScenario].description;
            updateTable(); updateResults();
        });
        document.querySelectorAll('input[name="regType"]').forEach(r => r.addEventListener('change', e => {
            regType = e.target.value;
            document.getElementById('alphaGroup').style.display = regType !== 'none' ? 'block' : 'none';
            document.getElementById('l1RatioGroup').style.display = regType === 'elastic' ? 'block' : 'none';
            updateRegInfo(); updateResults();
        }));
        document.getElementById('alpha').addEventListener('input', e => {
            alpha = parseFloat(e.target.value);
            document.getElementById('alphaValue').textContent = alpha.toFixed(2);
            document.getElementById('alphaDesc').textContent = alpha < 0.3 ? 'ì•½í•œ ì •ê·œí™” - ë°ì´í„°ì— ë” ë§ì¶¤' : alpha < 0.7 ? 'ì¤‘ê°„ ì •ê·œí™” - ê· í˜•ì¡í˜' : 'ê°•í•œ ì •ê·œí™” - ë” ë‹¨ìˆœí•œ ëª¨ë¸';
            updateResults();
        });
        document.getElementById('l1Ratio').addEventListener('input', e => {
            l1Ratio = parseFloat(e.target.value);
            document.getElementById('l1Value').textContent = l1Ratio.toFixed(2);
            document.getElementById('l2Value').textContent = (1 - l1Ratio).toFixed(2);
            document.getElementById('l1Desc').textContent = l1Ratio < 0.3 ? 'Ridgeì— ê°€ê¹Œì›€' : l1Ratio < 0.7 ? 'ê· í˜•ì¡íŒ í˜¼í•©' : 'Lassoì— ê°€ê¹Œì›€';
            updateResults();
        });

        // ------------------------------------------------------------------
        // â­ï¸ [ìˆ˜ì •ëœ ë¶€ë¶„]: íˆ´íŒì´ í´ë¦­ ìœ„ì¹˜ ê·¼ì²˜ì— ì •í™•íˆ ë‚˜íƒ€ë‚˜ë„ë¡ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ë³´ì •
        // ------------------------------------------------------------------
        function showSparrowPopup(e) {
        const popup = document.getElementById('sparrowPopup');
        
        // 1. ìœ„ì¹˜ ì„¤ì •: e.clientX, e.clientY (í™”ë©´ ê¸°ì¤€)ì— ìŠ¤í¬ë¡¤ëœ ì–‘ì„ ë”í•´ ë¬¸ì„œ ê¸°ì¤€ ìœ„ì¹˜ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
        const leftPosition = e.clientX + window.scrollX + 10; // ê¸°ì¡´ ì˜¤ë¥¸ìª½ 10px ì´ë™ ìœ ì§€ + ìŠ¤í¬ë¡¤ X ë³´ì •
        const topPosition = e.clientY + window.scrollY - 30; // ê¸°ì¡´ ìœ„ë¡œ 30px ì´ë™ ìœ ì§€ + ìŠ¤í¬ë¡¤ Y ë³´ì •

        popup.style.left = `${leftPosition}px`;
        popup.style.top = `${topPosition}px`;
        
        // 2. í´ë˜ìŠ¤ ì¶”ê°€: CSSì— ì •ì˜ëœ 'show' í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•˜ì—¬ ë³´ì´ê²Œ í•©ë‹ˆë‹¤.
        popup.classList.add('show');
        
        // 3. ì ì‹œ í›„ ì‚¬ë¼ì§€ë„ë¡ ì„¤ì • (0.5ì´ˆ í›„)
        setTimeout(() => {
            popup.classList.remove('show');
        }, 500); 
    }
    
    // ------------------------------------------------------------------
    // window.onload í•¨ìˆ˜: ëª¨ë“  ì´ˆê¸°í™” ë° ì´ë²¤íŠ¸ ì—°ê²°ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.
    // ------------------------------------------------------------------
    window.onload = function() {
        // 1. í•µì‹¬ ê¸°ëŠ¥ ì´ˆê¸°í™” (ê·¸ë˜í”„, í…Œì´ë¸”, ê²°ê³¼)
        initScatterChart();
        updateTable();
        updateResults();
        updateRegInfo();

        // 2. íˆ´íŒ ì´ë²¤íŠ¸ ì—°ê²° (ì•„ì´ì½˜ì´ ë¡œë“œëœ í›„ ì—°ê²°)
        const sparrowIcon = document.getElementById('ridgeIcon');
        if(sparrowIcon) {
            sparrowIcon.addEventListener('click', showSparrowPopup);
        }
    };
    </script>
</body>
</html>